<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Trからのぷろansitional//EN">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>DxBase2015ドキュメント(2015年)</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<div id="header">
<h2>０．チュートリアル</h2>
</div>
<!-- コンテンツ　-->
<div id="contents">
<h3>００１．空のプロジェクト</h3>
<br />
<h4>ソリューションを開いて、ビルド、実行する</h4>
　<b>001空のプロジェクト</b>ディレクトリには、ゲームのベースになる「何もしない」プロジェクトがあります。<b>001空のプロジェクト</b>ディレクトリ内の<b>DxBase2015Desktop.sln</b>を<b>VisualStdio2013</b>で読み込んでください。動作環境にあっていれば、実行できます。<br />
　ソリューションを開きましたら、<b>ビルド：ソリューションのリビルド</b>を実行してください。<br />
　ビルドが終了しましたら、<b>デバッグ：デバッグなしで開始</b>を実行してください。以下のような画面が現れます。もし起動できないなどの場合は、もう一度お使いの環境が動作環境にあってるかご確認ください。<br />
<p>&nbsp;</p>
<img src="img/0001a.jpg" width="80%"/>
<p>図0000a</p>
<p>&nbsp;</p>

<br />
<h4>空のプロジェクトの内容</h4>
　プロジェクトの<b>ソリューションエクスプローラー</b>を見ると以下のようになってます。
<p>&nbsp;</p>
<img src="img/0001b.jpg" width="40%"/>
<p>図0000b</p>
<p>&nbsp;</p>
　まず、<b>DirectXTXプロジェクト</b>はテクスチャ読み込みに利用している、Microsoft社の<b>DirectXTX</b>です。ソースファイルで提供されているので、ソリューションに含めています。リビルドのときに、<b>libファイル</b>を作成しています。<br />
　<b>ソースファイル</b>というフィルターには、ゲームコンテンツのソースファイル、<b>ヘッダーファイル</b>というフィルターには、ゲームコンテンツのヘッダファイルが入っています。<b>シェーダファイル</b>はゲームコンテンツで作成する独自のシェーダーを入れます。今は独自のシェーダーはないので空になってます。<br />
　<b>BaseLib</b>というフィルタには<b>フレームワーク本体</b>が入ってます。フレームワークはチュートリアルやサンプルで共通で使用するので、それらのソリューションディレクトリの外に置かれています。<br/>
<br />
　新しく、自分のゲームを作成する場合は、この<b>001空のプロジェクトディレクトリ</b>と<b>Libsディレクトリ</b>をディレクトリごと別の階層に（マイドキュメント配下など）にコピーし、<b>「001空のプロジェクト」ディレクトリ名を</b>別のディレクトリ名（例、マイゲーム、など）に変更しソリューションを開きます。<br />
　<b>BaseLib</b>フィルタの配下のファイルは、<b>Headers、Sources、Shaders</b>という3つのサブフィルターがあり、それぞれ<b>フレームワークのヘッダ、ソース、シェーダー</b>が置かれています。<br />
　フレームワークのコメントは<b>Doxygen形式</b>で記述されていますので、簡単にhtml化できます。<br/>
<br />
　<b>001空のプロジェクト</b>は何もしませんが、ゲームを作成する準備はすべて整ってます。<br />
　次項から、オブジェクトの配置などの説明をしますが、今項では、それらのソースファイルやクラスの役割を簡単に述べます。<br />
<br />
<h4>GameStage.h、GameStage.cpp</h4>
　<b>DxBase2015</b>では、<b>シーン、ステージ、ゲームオブジェクト</b>という3つの階層で、ゲームを管理します。<br />
　<b>シーン</b>は<b>ゲーム全体</b>です。1つのゲームは1つのシーンを持ちます。<br />
　<b>ステージ</b>はオブジェクトが配置されるステージです。<b>ゲーム画面</b>ばかりではなく、<b>タイトル、リザルト画面、ステージセレクト画面</b>など、ゲームには複数のステージがありますが、これらは別のステージとして作成します。それらを統括してまとめるのが<b>シーン</b>という関係になります。<br />
　<b>GameStage.h、GameStage.cpp</b>はこの中で、<b>ゲーム画面</b>を定義するファイルです。タイトルやリザルト画面はこのサンプルではありませんが、<b>ゲーム画面</b>同様の方法で作成することができます。<br />
　<b>GameStage.h</b>は以下のようになってます。
<div class="box1">
<pre>
#pragma once

#include "stdafx.h"

namespace basedx11{
    //--------------------------------------------------------------------------------------
    //  class GameStage : public Stage;
    //  用途: ゲームステージクラス
    //--------------------------------------------------------------------------------------
    class GameStage : public Stage{
        //ビューの作成
        void CreateViews();
    public:
        //構築と破棄
        GameStage() :Stage(){}
        virtual ~GameStage(){}
        //初期化
        virtual void Create()override;
    };
}
//endof  basedx11
</pre>
</div>
　ここには、<b>GameStageクラス</b>が宣言されています。<br />
　コンストラクタ、デストラクタは内容は空です。コンストラクタは、親ステージのコンストラクタを、メンバイニシャライザから呼び出しています。<br />
　<b>CreateViews()関数とCreate()仮想関数</b>は宣言だけ行い、実体は<b>GameStage.cpp</b>に記述します。<br />
<br/>
　<b>GameStage.cpp</b>は以下のようになってます。
<div class="box1">
<pre>
#include "stdafx.h"
#include "Project.h"

namespace basedx11{
    //--------------------------------------------------------------------------------------
    //  class GameStage : public Stage;
    //  用途: ゲームステージクラス
    //--------------------------------------------------------------------------------------
    //ビュー類の作成
    void GameStage::CreateViews(){
        //最初にデフォルトのレンダリングターゲット類を作成する
        CreateDefaultRenderTargets();
        //マルチビューコンポーネントの取得
        auto PtrMultiView = GetComponent&lt;MultiView>();
        //マルチビューにビューの追加
        auto PtrView = PtrMultiView->AddView();
        //ビューの矩形を設定（ゲームサイズ全体）
        Rect2D&lt;float> rect(0, 0, 
            (float)App::GetApp()->GetGameWidth(), (float)App::GetApp()->GetGameHeight());
        //最初のビューにパラメータの設定
        PtrView->ResetParamaters&lt;Camera, MultiLight>(
            rect, Color4(0.0f, 0.125f, 0.3f, 1.0f), 1, 0.0f, 1.0f);
    }
    //初期化
    void GameStage::Create(){
        try{
            //ビュー類を作成する
            CreateViews();

        }
        catch (...){
            throw;
        }
    }
}
//endof  basedx11
</pre>
</div>
　<b>void GameStage::CreateViews()関数</b>では、最初に、<b>CreateDefaultRenderTargets()</b>という関数を呼び出して、DitrectX11の<b>ID3D11RenderTargetViewなどのインターフェイス類</b>を初期化します。このインターフェイスセットは、RenderTargetViewのほかに、深度バッファ、影（シャドウマップ）などを持ちます。<br />
　続いて<b>ビュー</b>を作成します。<br />
　<b>ビュー</b>というのは、<b>１つのカメラで見る窓</b>のようなものです。ステージには、ゲームステージに限らず複数の<b>ビュー</b>を登録することができます。複数のビューは、たとえばミニマップや画面分割をする際に使用します。このサンプルではビューは1つだけです。<br />
　まず、ビューの親となる<b>マルチビューコンポーネント</b>を取得し、ビューを１つ追加します。<br />
　追加したらそのビューにパラメータを設定します。
<div class="box1">
<pre>
        //最初のビューにパラメータの設定
        PtrView->ResetParamaters&lt;Camera, MultiLight>(
            rect, Color4(0.0f, 0.125f, 0.3f, 1.0f), 1, 0.0f, 1.0f);
</pre>
</div>
　ここでは、ビューの矩形は画面全体、背景色は濃い青、ライトは１つで、ビューの深度を0.0から1.0の間にします。<br />
　ビューの深度は、ビューが重なったときに意味を持ちます。深度は0.0から1.0が最大値です。たとえば、0.0から0.49までのビューAと、0.5から1.0までのビューBがあった場合、ビューAは必ずビューBの上に表示されます。<br />
<br />
　<b>void GameStage::Create()関数</b>は、ゲームステージのインスタンスが構築されたときに、自動的に呼び出される仮想関数です。ここでは、<b>CreateViews()関数</b>を呼び出しています。<br />
<br />
<h4>そのほかのソースコード</h4>
　<b>空のプロジェクト</b>で、具体的に記述するのは以上です。ほかのソースはデフォルトの状態です。<br />
　シーンクラスである<b>Scene.hとScene.cpp</b>は、最初に<b>GameStageクラスのインスタンス</b>をアクティブにします。<br />
　<b>WinMain.cpp</b>はこのアプリケーションのエントリポイントなどが記述されます。Windowsとやり取りをする場合は、ここにソースを追加記述しますが、このサンプルではデフォルトのままです。<br />
　<b>Player.hとPlayer.cpp</b>は主に、プレイヤー（入力装置で動作するキャラクタ）を記述するために準備されてたファイルです。ここでは何も記述がありません。<br />
　<b>Character.hとCharacter.cpp</b>は敵キャラなどを記述します。ここでは記述がありません。<br />
　<b>Project.h</b>には、ゲーム側で利用するヘッダをまとめておきます。ゲームが大きくなると、ファイル数はこれだけではとても足りません。新たに作成したヘッダは、<b>Project.h</b>にまとめておくと便利です。<br/>
<br />
　<b>空のプロジェクト</b>は、新規でゲームを作成するときにひな形として利用します。<br />
　ディレクトリ名（空のプロジェクト）を変更して別にコピーし、<b>Libs</b>ディレクトリも同じ階層にコピーしてソリューションを呼び出すと、新規でゲームの作成を始められます。<br />
　<b>DxBase2015</b>で作成する実行ファイルは、デフォルトで<b>DxBase2015Desktop.exe</b>です。サンプルもすべて同じです。ウインドウタイトルは、デフォルトで<b>DxBase2015Sample</b>です。<br />
　ゲームの実行ファイル名を変更する場合は、以下のようにソリューションエクスプローラーのプロジェクト名をゲーム名（実行ファイル名）に変更します。以下の例ですと<b>MyGame.exe</b>が生成されます。
<p>&nbsp;</p>
<img src="img/0001c.jpg" width="40%"/>
<p>図0000c</p>
<p>&nbsp;</p>
　また、ウインドウのタイトルを変更する場合は、<b>WinMain.cpp</b>の上部にある、<b>const wchar_t* pWndTitle</b>を、変更します。<br />
　<b>const wchar_t* pWndTitle</b>はDxBase2015には数少ないグローバル変数です。
<div class="box1">
<pre>
const wchar_t* pWndTitle = L"MyGame";
</pre>
</div>
　こんな感じです。これで、ウインドウタイトルが<b>MyGame</b>になります。<br />
<p>&nbsp;</p>
<img src="img/0001d.jpg" width="80%"/>
<p>図0000d</p>
<p>&nbsp;</p>
<br />
　新しいゲームを作成する場合は、このように、実行ファイル名とウインドウタイトルの変更を最初に行うとよいでしょう。
<br />
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<ul class="foot_navi">
<li><a href="00_00.html">前ページ</a></li>
<li><a href="index.html">目次</a></li>
<li><a href="00_02.html">次ページ</a></li>
</ul>
<!-- /フッタ　-->


</div>
<!-- /全体コンテナ　-->
</body>
</html>
