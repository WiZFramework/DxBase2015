<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Trからのぷろansitional//EN">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>DxBase2015ドキュメント(2015年)</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<div id="header">
<h2>２．カメラとコントローラ以外の入力</h2>
</div>
<!-- コンテンツ　-->
<div id="contents">
<br/>
<h3>２０１．キーボードとマウス入力</h3>
<h4>入力キーの設定</h4>
　ドキュメントにあるサンプルやチュートリアルは、<b>XBOXコントローラ</b>で操作するサンプルがほとんどですが、<b>DxBase2015</b>はキーボードやマウスによる操作をすることが可能です。<br />
　<b>Sample201ディレクトリ</b>のソリューションを開いて、リビルド実行すると以下の画面が現れます。
<p>&nbsp;</p>
<img src="img/2001a.jpg" width="80%"/>
<p>図2001a</p>
<p>&nbsp;</p>
　この画面で、<b>マウスの左ボタン</b>をクリックすると、オブジェクトが左に移動し、<b>マウスの右ボタン</b>をクリックすると、右に移動します。<br />
　また、キーボードの<b>Fキー</b>を押すと左に移動し、<b>Gキー</b>を押すと右に移動します。<br />
　まず、キーボード、マウスを使う場合は<b>WinMain.cpp</b>に以下のように、使うキーやマウスを設定します。<b>MainLoop()関数</b>です。
<div class="box1">
<pre>
int MainLoop(HINSTANCE hInstance, HWND hWnd, bool isFullScreen, int iClientWidth, int iClientHeight){
    //中略

        //メッセージループ
        MSG msg = { 0 };
        //キーボード入力用
        //ここに設定したキーボード入力を得る
        <span class="red">vector&lt;DWORD> UseKeyVec = {
            'F', 'G', VK_LBUTTON, VK_RBUTTON
        };</span>

    //中略

}
</pre>
</div>
　このようにしておくとゲーム内で、マウスやキーボードを受け取れるようになります。<br />
　実際に使っているのは<b>Character.cppのBox::Update()関数</b>です。
<div class="box1">
<pre>
    void Box::Update(){
        //前回のターンからの経過時間を求める
        float ElapsedTime = App::GetApp()->GetElapsedTime();
        auto PtrTransform = GetComponent&lt;Transform>();
        //位置の取得
        auto Pos = PtrTransform->GetPosition();
        <span class="red">auto Key = App::GetApp()->GetInputDevice().GetKeyState();</span>

        if (Key.m_bPushKeyTbl['F'] || Key.m_bPushKeyTbl[VK_LBUTTON]){
            Pos.x -=  ElapsedTime;
        }
        else if (Key.m_bPushKeyTbl['G'] || Key.m_bPushKeyTbl[VK_RBUTTON]){
            Pos.x += ElapsedTime;
        }

        //もし、キーを押した瞬間かマウスをクリックした瞬間をとってくる場合は、
        //上記をコメントにし以下を有効にする
        /*
        if (Key.m_bPressedKeyTbl['F'] || Key.m_bPressedKeyTbl[VK_LBUTTON]){
            Pos.x -= ElapsedTime * 5.0f;
        }
        else if (Key.m_bPressedKeyTbl['G'] || Key.m_bPressedKeyTbl[VK_RBUTTON]){
            Pos.x += ElapsedTime * 5.0f;
        }
        */

        //もし、キーを離した瞬間かマウスをアップした瞬間をとってくる場合は、
        //上記をコメントにし以下を有効にする
        /*
        if (Key.m_bUpKeyTbl['F'] || Key.m_bUpKeyTbl[VK_LBUTTON]){
            Pos.x -= ElapsedTime * 5.0f;
        }
        else if (Key.m_bUpKeyTbl['G'] || Key.m_bUpKeyTbl[VK_RBUTTON]){
            Pos.x += ElapsedTime * 5.0f;
        }
        */

        PtrTransform->SetPosition(Pos);
    }
</pre>
</div>
　赤くなっているところのようにキーの状態を取得できます。マウスもキーの1つとして扱います。<br />
　コメントになっているところをコメントにあるように有効無効を切り替えると、押した瞬間や離した瞬間をとってこれます。<br />
　またマウスカーソルの位置は、<b>Key.m_MouseClientPoint</b>でクライアント座標をとれます。<br />
　スクリーン上のマウスカーソルの位置を取得する場合は<b>GetCursorPos()関数（WindowsAPI）</b>をお使いください。<br />
<br />
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<ul class="foot_navi">
<li><a href="index.html">目次</a></li>
<li><a href="20_02.html">次ページ</a></li>
</ul>
<!-- /フッタ　-->


</div>
<!-- /全体コンテナ　-->
</body>
</html>
