<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>DxBase2015ドキュメント(2015年)</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<div id="header">
<h2>１．更新補助</h2>
</div>
<!-- コンテンツ　-->
<div id="contents">
<br/>
<h3>１０３．アクションと衝突判定</h3>
<h4>アクションに衝突を実装する</h4>
　アクションが実装してあるオブジェクトに対して、衝突判定を実装するには注意が必要です。<br />
　サンプル103では、簡単な例を紹介しています。Sample103ディレクトリ内のソリューションを開いてリビルドして実行すると以下のような画面が現れます。
<p>&nbsp;</p>
<img src="img/1003a.jpg" width="80%"/>
<p>図1003a</p>
<p>&nbsp;</p>
　ここでは、簡単なアクションが実装されている球体とプレイヤーがあります。プレイヤーはチュートリアルで実装したものとほぼ同じです。<br />
　プレイヤーを動かして、アクション球体に衝突させると、アクション球体の動きが変わります。<br/>
　つまり、衝突の瞬間に、アクションを変更しているのです。ポイントはアクション球体<b>ActionObjectクラス</b>の<b>Update2()関数</b>です。以下に紹介します。
<div class="box1">
<pre>
    void ActionObject::Update2(){
        //何かと衝突していたら
        auto ColPtr = GetComponent&lt;CollisionSphere>();
        if (ColPtr->GetHitObject()){
            auto PtrTrans = GetComponent&lt;Transform>();
            auto Pos = PtrTrans->GetPosition();

            auto OtherPtr = ColPtr->GetHitObject()->GetComponent&lt;Transform>();
            auto OtherPos = OtherPtr->GetPosition();

            auto Span  = Pos - OtherPos;
            auto Span2 = Pos - OtherPos;

            //衝突してないと思われる位置まで移動
            Span.Normalize();
            Span.y = 0.0f;
            Span *= 0.125f;
            Pos += Span;
            Pos.y = 0.125f;
            PtrTrans->SetPosition(Pos);
            //衝突後移動方向の計算
            Span2.Normalize();
            Span2 *= 3.0f;
            Span2.y = 0.0f;

            //お互いの衝突情報をクリアする
            //こうしておくと比較的スムーズな反射が得られる
            ColPtr->ClearBothHitObject();

            <span class="red">//アクションの取得
            auto PtrAction = GetComponent&lt;Action>();
            //現在のすべてのアクションをクリア
            PtrAction->AllActionClear();
            //アクションの設定し直し
            PtrAction->AddRotateBy(1.0f, Vector3(0, XM_PI, 0));
            PtrAction->AddMoveBy(1.0f, Span2);
            //ループする
            PtrAction->SetLooped(true);
            //アクション開始
            PtrAction->Run();</span>

        }
    }
</pre>
</div>
　赤くなっているところが、アクションを変更しているところです。これまでのアクションをすべてクリアして、再登録しています。

<br />
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<ul class="foot_navi">
<li><a href="10_02.html">前ページ</a></li>
<li><a href="index.html">目次</a></li>
<li><a href="10_04.html">次ページ</a></li>
</ul>
<!-- /フッタ　-->


</div>
<!-- /全体コンテナ　-->
</body>
</html>
