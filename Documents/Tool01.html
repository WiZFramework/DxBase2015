<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>DxBase2015ドキュメント(2015年)</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<div id="header">
<h2>ツール</h2>
</div>
<!-- コンテンツ　-->
<div id="contents">
<br/>
<h3>Tool01．FBXを独自のバイナリデータに変換する</h3>
<br />
<h4>ツールの必要性について考えてみよう</h4>
　<b>BaseDx2015(フルバージョン)</b>には、FBX_SDKを利用したモデルの読み込みなどはじめ、これまで紹介してきたいろんな機能が含まれます。<br />
　しかし、それらの機能は、往々にして大きなライブラリになりがちなため、最小限のライブラリとして<b>シンプルバージョン</b>も用意しています。<br />
　<b>シンプルバージョン</b>は、FBX_SDKも内蔵されていません。しかし、３Ｄゲーム制作にはモデルの描画は、必須といってもいいでしょう。<br />
　そこで、<b>シンプルバージョン用</b>として、<b>FBXファイルから、独自のフォーマットのデータを作成するツール</b>を作成しました。<br />
　今回紹介するツールは、ツールとして最小限のことしか行いません。もし多機能なツールが必要であれば、今項で紹介するツールをカスタマイズして、独自のツールに進化させるとよいでしょう。<br />
<br />
<h4>Fbx2Binについて</h4>
　<b>Tool01ディレクトリ</b>には、この項で紹介する<b>Fbx2Bin</b>が含まれます。<br />
　まず、起動する前に、何か、テスト用のFBXファイルを用意してください。<br />
　<b>Sample308</b>で紹介した、<b>Chara_R.fbxやChara_B.fbx</b>でも構いません。このFBXファイルを、テクスチャ画像も含まれるディレクトリごと、<b>Tool01ディレクトリ</b>の<b>mediaディレクトリ</b>に保存してください。<br />
　<b>mediaディレクトリ</b>にFBXファイルを配置したら、<b>Fbx2Bin</b>を起動してみましょう。<br />
　今回のツールは<b>MFC</b>を使用していますので、<b>VisualStdio2013</b>は<b>Community以上</b>でないと起動しませんので注意してください。<br />
　起動すると以下の画面になります。
<p>&nbsp;</p>
<img src="img/Tool01a.jpg" width="80%"/>
<p>図Tool01a</p>
<p>&nbsp;</p>
　ここで、まず<b>基準ディレクトリ</b>を<b>mediaディレクトリ内</b>の<b>FBXが含まれるディレクトリ</b>を記述してください。<br />
　続いて、<b>Fbxファイル名</b>を記述してください。<br />
　記述したら表示用のスケーリングを記述してください（デフォルト1.0になっています）。<br />
　以下の例では、<b>Sample308のChara_R.fbx</b>をコピーしてきて表示させたものです。
<p>&nbsp;</p>
<img src="img/Tool01b.jpg" width="80%"/>
<p>図Tool01b</p>
<p>&nbsp;</p>
　コントローラを使用すると、後方からも見ることができます。<b>Sample308のChara_R.fbx</b>はスキンメッシュですが、ご覧のように<b>Tポーズ</b>をしたスタティックメッシュとして表示します。<br/>
　<b>Sample308のChara_R.fbx</b>はサイズが大きいので、<b>スケーリングを0.02</b>で読み込みます。<br />
<br />
<h4>データの保存</h4>
　データの保存は、スタティックメッシュでよいなら、<b>スタティックデータ保存</b>をクリックします。保存に成功すると、
<p>&nbsp;</p>
<img src="img/Tool01c.jpg" width="40%"/>
<p>図Tool01c</p>
<p>&nbsp;</p>
　のようなダイアログが出ます。<br />
　単純ですが、スタティックメッシュについてはこれだけです。<b>mediaディレクトリのFBXのディレクトリ</b>を見ますと<b>Chara_R.bin</b>ができているのがわかります。<br />
　この項で作成したデータは<b>DxBase2015Simple/Simple06サンプル</b>で実装します。<br />
　こちらのサンプルは、独自のデータフォーマットのモデル（メッシュ）を読み込むサンプルです。<br />
　<b>Fbx2Binツール</b>と比べながら確認してください。<br />
<br />
<h4>スキンメシュ</h4>
　スキンメッシュについては<b>「動作させてみる」「秒あたりのサンプリング間隔を指定して保存」</b>の手順を踏みます。<br />
　まず<b>「動作させてみる」</b>ですが、スキンメッシュにあらかじめ設定してあるアニメーション（アニメーションラインは1つだけ有効です）の、<b>開始フレームと、開始からのフレーム数、そして、秒あたりのフレーム数</b>を指定して、<b>動かしてみる</b>ボタンをクリックします。サンプルの<b>Chara_R.fbx</b>は,全体で20フレームなので、その値を指定しています。ゆっくり動くように、<b>秒あたりのフレーム数は10</b>としています。以下のような画面になります。
<p>&nbsp;</p>
<img src="img/Tool01d.jpg" width="80%"/>
<p>図Tool01d</p>
<p>&nbsp;</p>
　動作を確認したら、<b>「秒あたりのサンプリング間隔を指定して保存」</b>です。<b>サンプリング間隔(秒)</b>に値（<b>ここでは0.02</b>を指定）して、<b>スキンメッシュデータ保存</b>ボタンをクリックすると、先ほどのようなダイアログが出て保存できます。<br />
　ここで作成したスキンメッシュデータは<b>DxBase2015Simple/Simple07サンプル</b>で表示しています。<br />
<br />
<h4>スキンメシュデータの仕組み</h4>
　スキンメッシュのデータは、fbxの作成時の作成方法によって、どのような保存の仕方をすれば効率よく独自データ化にできるか、を考える必要があります。<br />
　このツールでは、<b>サンプリング方式</b>をとっています。つまりフレーム間の補間をFBX_SDKに任せて、その結果をデータ化しています。ですので、サンプリング間隔が小さければ、よりfbxデータに忠実なアニメーションになります。しかし、細かすぎるとデータが大きくなります。<br />
　再生側では、<b>DxBase2015Simple/Simple07サンプル</b>で行っているように、サンプリングされたデータを通常の線形補間を使って間を埋めます。補間方法が単純なので、サンプリング間隔が大きいと、fbxデータとは離れた再生になります。<br />
　ここで指定した<b>0.02</b>は、つまりは50分の1秒単位で取得します。取得するのはボーン単位の行列です。動作させてみると約2秒でひとまわりするデータなので、100個のサンプリングになります。ボーン数は22個なので、全部で2200個の行列が保存されます。保存データサイズは約400キロバイトです。もとのfbxが1200キロなので、約3分の1になった計算になります。<br />
<br />
　今項では、コード説明は省略いたします。<b>DxBase2015Simple/Simple06、Simple07サンプル</b>の説明を参照してください。<br />
　またMFCの扱いに慣れてないと、最初は理解しにくいかもしれませんが、慣れてくると、MFCは非常に使いやすいライブラリであることがわかると思います。
<br />
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<ul class="foot_navi">
<li><a href="index.html">目次</a></li>
</ul>
<!-- /フッタ　-->


</div>
<!-- /全体コンテナ　-->
</body>
</html>
